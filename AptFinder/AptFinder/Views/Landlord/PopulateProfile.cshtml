@{
    Layout = "~/Views/_Layout.cshtml";

    var locs = ViewBag.Locations;

}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style>
    td {text-align: center}
</style>

<div id="addLocModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add Location</h4>
            </div>
            <div class="modal-body">                
                <form>
                    <div class="form-group">
                        <label for="name">Location Name :</label>
                        <input class="form-control" type="text" id="name" name="name" />
                    </div>
                    <h3>-- Address --</h3>
                    <div class="form-group">
                        <label for="street">Street :</label>
                        <input class="form-control" type="text" id="street" name="street" />
                    </div>
                    <div class="form-group">
                        <label for="city">City :</label>
                        <input class="form-control" type="text" id="city" name="city" />
                    </div>
                    <div class="form-group">
                        <label for="state">State :</label>
                        <select class="form-control" id="state" name="state">
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="DC">District Of Columbia</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="zip">Zipcode :</label>
                        <input class="form-control" type="text" id="zip" name="zip" />
                    </div>
                    <hr />
                    <div class="form-group">
                        <label for="description">Description:</label>
                        <input class="form-control" rows="5" cols="50" type="textarea" id="description" name="description" />
                    </div>                   
                </form>
            </div>
            <div class="modal-footer">
                <button id="submitNewLoc" type="button" class="btn btn-default" data-dismiss="modal">Submit New Location</button>
            </div>
        </div>

    </div>
</div>
<div id="removeLocModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Remove Location</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="remLocation">Location to Remove</label>
                    <select class="form-control" id="remLocation" name="remLocation">
                        @foreach (var loc in locs)
                        {
                            <option value="@loc.LocationID">@loc.Name - @loc.Street, @loc.City, @loc.State </option>
                        }
                    </select>    
                </div>  
                
            </div>
            <div class="modal-footer">
                <button id="removeLoc" type="button" class="btn btn-default" data-dismiss="modal">Remove Location</button>
            </div>
        </div>

    </div>
</div>

<div>
    <h3>@ViewBag.Landlord.Name 's Profile</h3>
    <div class="row">
        <button id="" class="btn btn-default btn-md" data-toggle="modal" data-target="#addLocModal">Add Location</button>
    </div>
    <table class="table">        
        <thead><tr><td>Location</td></tr></thead>
        <tbody>
            @foreach (var l in locs)
            {
                <tr>
                    <td>@l.Name</td>
                    <td>
                        <a href='@Url.Action("EditLocation","Location", new { id = l.LocationID })' class="btn btn-default btn-sm">Edit Location</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBU-9q6heUHwYsxyvoA7VxzUa_aNsKzCDA&callback=initMap">
</script>
<script>


    $('#submitNewLoc').click(function () {

        var geocoder = new google.maps.Geocoder();
        var address = $("#street").val() + "," + $("#city").val() +
            "," + $("#state").val() + "," + $("#zip").val()

        var latitude;
        var longitude;

        geocoder.geocode({ 'address': address }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                latitude = results[0].geometry.location
            } else {
                alert("Your address could not be found for the following reason: " + status);
            }                
        })

        var addLocation = {
            name: $("#name").val(),
            lat: latitude,
            lng: longitude,
            street : $("#street").val(),
            city : $("#city").val(),
            state : $("#state").val(),
            zip: $("#zip").val(),
            landID: '@ViewBag.Landlord.LandlordID',
            description : $("#description").val()
        }

        $.ajax({
            type: 'POST',
            url: '@Url.Action("AddLocation","Location")',
            data: JSON.stringify(addLocation),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                console.log("Hardcore you added a location")
            }
        });
    })

    $('#RemoveLoc').click(function () {
        var addLocation = {
            locID: $("#remLocation").val(),
        }

        $.ajax({
            type: 'POST',
            url: '@Url.Action("RemoveLocation","Location")',
            data: JSON.stringify(addLocation),
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                console.log("Hardcore you removed a location")
            }
        });
    })

    
</script>